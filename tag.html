<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Similar head content as in tags.ejs file -->
  <title>Tag - Nerdy thoughts of a Digital Jockey</title>
</head>
<body>
  <div class="container mt-4">
    <!-- Navigation Bar -->
    <nav class="navigation mb-4">
      <a href="/">Nerdy thoughts of a Digital Jockey</a>
    </nav>

    <!-- Articles for a specific tag -->
    <div id="tag-articles-block">
      <!-- Articles will be populated by JavaScript -->
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Decoding the tag from the URL query parameter
      const urlParams = new URLSearchParams(window.location.search);
      const tag = decodeURIComponent(urlParams.get('tag'));
  
      // Define a function to safely retrieve articles data
      function getArticlesData() {
        const rawData = document.getElementById('articles-data').textContent;
        try {
          return JSON.parse(rawData);
        } catch (e) {
          console.error('Error parsing articles data:', e);
          return [];
        }
      }
  
      // Retrieve and parse articles data
      const articlesData = getArticlesData();
  
      // Filtering articles based on the decoded tag
      const articlesForTag = articlesData.filter(
        article => article.tags && article.tags.includes(tag)
      );
  
      // Displaying the articles in the tag-articles-block
      const articlesBlock = document.getElementById('tag-articles-block');
      if (articlesForTag.length > 0) {
        articlesForTag.forEach(article => {
          const articleElement = document.createElement('div');
          articleElement.classList.add('tag-article-item');
          articleElement.innerHTML = `
            <time datetime="${new Date(article.createdAt).toISOString()}" class="mr-2 text-muted">
              ${new Date(article.createdAt).toLocaleDateString()}
            </time>
            <a href="/${article.fullUrl}">${article.title}</a>
          `;
          articlesBlock.appendChild(articleElement);
        });
      } else {
        articlesBlock.innerHTML = '<p>No articles found for this tag.</p>';
      }
    });
  </script>
  
</body>
</html>
